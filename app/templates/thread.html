{% extends 'base.html' %}

{% block content %}
	<article>
		<header>
			<h2>{{ thread.title|safe }}</h2>
		</header>
		{{ thread.body|oembed(urlize_all=False, maxwidth=800)|markdown|safe }}
		<footer>
			<time pubdate="pubdate">{{ thread.date_created|safe }}</time>&nbsp;|&nbsp;
			{% if thread.user %}
			<strong>{{ thread.user.username|safe }}</strong>
			{% else %}
			<strong>{{ thread.display_name|safe }}</strong>
			{% endif %}
		</footer>
	</article>
	{% for post in thread.posts %}
		<article id="p{{ post.id }}">
			{{ post.body|oembed(urlize_all=False, maxwidth=800)|markdown|safe }}
			<footer>
				<time pubdate="pubdate">{{ post.date_created|safe }}</time>&nbsp;|&nbsp;
				{% if post.user %}
				{{ post.user.username|safe }}
				{% else %}
				{{ post.display_name|safe }}
				{% endif %}
			</footer>
		</article>
	{% endfor %}
	<form class="pure-form pure-form-stacked" method="POST" action="{{ url_for('new_thread') }}/{{ thread.display_hash|safe }}/{{ thread.url_title()|safe }}">
		{% if form.errors %}
		    <ul>
		        {% for field_name, field_errors in form.errors|dictsort if field_errors %}
		            {% for error in field_errors %}
		                <li>{{ form[field_name].label }}: {{ error }}</li>
		            {% endfor %}
		        {% endfor %}
		    </ul>
		{% endif %}
		<fieldset>
			<input type="hidden" name="display_hash" value="{{ thread.display_hash }}" />
			{{ form.body(cols='80', rows='10') }}
			{% if not current_user.is_active() %}
			{{ form.display_name }}
			{% endif %}
			<button type="submit" class="pure-button pure-button-success">Add Comment</button>
			<a href="{{ url_for('index') }}" class="pure-button pure-button-error">Cancel</a>
		</fieldset>
	</form>
{% endblock %}